<% include ./facebookAPI/facebookSDK.ejs %>
<% include ./kakaoAPI/kakaoSDK.ejs %>
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse">
  <div class="container">
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/"><span class="glyphicon glyphicon-home"></span> 세 일 중 </a>
      </li>
    </ul>
    <p class="navbar-text">세일 중인 모든 상품을 주변 사람들에게 알릴 수 있습니다!</p>
    <ul id="navbar" class="nav navbar-nav navbar-right">
      <li>
        <a href="https://secret-peak-54499.herokuapp.com/register"><span class="glyphicon glyphicon-plus-sign"></span> 물건 등록 </a>
      </li>
      <li id="username">
        <a href="/login"><span class="glyphicon glyphicon-user"></span>Login</a>
      </li>
    </ul>
  </div>
</nav>

<script>
  function changeNavbar(id) {
    $("#username").text(id);
    $("#navbar").append('<li><a href="/admin"><span class="glyphicon glyphicon-user"></span>admin</a></li>');
    $("#navbar").append('<li><a href="/logout" onclick="FB.logout();"><span class="glyphicon glyphicon-user"></span>logout</a></li>');
  }
  console.log(111);
  FB.getLoginStatus(function(response) {
    if (response.status === 'connected') {
      var accessToken = response.authResponse.accessToken;
      var userID = response.authResponse.userID;
      $.ajax({
        type : 'get',
        url : 'https://graph.facebook.com/' + userID + '?access_token=' + accessToken,
        dataType : 'json',
        error: function (xhr, status, error) {
          console.log(error);
        },
        success : function (data) {
          console.log(data);
          console.log(data.id);
          changeNavbar(data.id);
        }
      });
    } else if (response.status === 'not_authorized') {
      console.log('eeerrrrrrrrrooooooorrrrrrrrrrrrr!!!!!!!!!!!!!!!!');
    } else {
      console.log('eeerrrrrrrrrooooooorrrrrrrrrrrrr!!!!!!!!!!!!!!!!');
    }
  });
</script>
